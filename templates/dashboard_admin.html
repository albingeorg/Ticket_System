{% extends "base.html" %}
{% block content %}
<h2>Admin Dashboard</h2>

<form class="filters" method="get">
  <input type="text" name="q" value="{{ request.args.get('q','') }}" placeholder="Search subject...">
  <select name="status">
    <option value="">All Statuses</option>
    {% for s in ["Open","In Progress","Resolved","Closed"] %}
      <option value="{{s}}" {% if request.args.get('status')==s %}selected{% endif %}>{{s}}</option>
    {% endfor %}
  </select>
  <select name="priority">
    <option value="">All Priorities</option>
    {% for p in ["Low","Medium","High","Urgent"] %}
      <option value="{{p}}" {% if request.args.get('priority')==p %}selected{% endif %}>{{p}}</option>
    {% endfor %}
  </select>
  <button type="submit">Apply</button>
  <a class="button" href="{{ url_for('new_ticket') }}">+ New Ticket</a>
</form>

<table class="table">
  <thead>
    <tr>
      <th>#</th><th>Subject</th><th>Priority</th><th>Status</th><th>Owner</th><th>Assignee</th><th>Updated</th><th></th>
    </tr>
  </thead>
  <tbody>
    {% for t in tickets %}
    <tr>
      <td>{{t.id}}</td>
      <td>{{t.subject}}</td>
      <td>{{t.priority}}</td>
      <td>{{t.status}}</td>
      <td>{{ t.owner.name }}</td>
      <td>{{ t.assignee.name if t.assignee else "-" }}</td>
      <td>{{ t.updated_at.strftime("%Y-%m-%d %H:%M") }}</td>
      <td><a class="button small" href="{{ url_for('view_ticket', ticket_id=t.id) }}">Open</a></td>
    </tr>
    {% else %}
    <tr><td colspan="8">No tickets.</td></tr>
    {% endfor %}
  </tbody>
</table>

<hr>
<h3>User Management</h3>
<a class="button" href="{{ url_for('manage_users') }}">Manage Users</a>
{% endblock %}
